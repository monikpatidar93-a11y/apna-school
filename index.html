<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Mini Flipkart</title>
<link rel="stylesheet" href="style.css">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body {
    margin:0;
    font-family: Arial, sans-serif;
    background:#f1f3f6;
}

.navbar {
    display:flex;
    align-items:center;
    padding:10px 20px;
    background-color:#2874f0;
    color:white;
    flex-wrap:wrap;
    gap:10px;
}
.navbar h2 { margin:0; }
.navbar input[type="text"] {
    flex:1;
    padding:8px 12px;
    border-radius:4px;
    border:none;
}
.navbar button {
    padding:8px 15px;
    background-color:#ff9f00;
    border:none;
    border-radius:4px;
    cursor:pointer;
    color:white;
    font-weight:bold;
}
.navbar a { color:white; text-decoration:none; margin-left:10px; }

.products-grid {
    display:grid;
    grid-template-columns:repeat(auto-fill,minmax(180px,1fr));
    gap:20px;
    padding:20px;
}
.item-card {
    background:white;
    border-radius:5px;
    padding:10px;
    text-align:center;
    box-shadow:0 2px 6px rgba(0,0,0,0.1);
    cursor:pointer;
}
.item-card img {
    width:100%;
    height:150px;
    object-fit:cover;
    border-radius:5px;
}
.item-card h4 { margin:10px 0 5px; font-size:16px; }
.item-card p { color:#ff3f6c; font-weight:bold; margin:0 0 10px; }
.item-card button {
    padding:6px 12px;
    border:none;
    background:#2874f0;
    color:white;
    border-radius:4px;
    cursor:pointer;
}
.banner img {
    width:100%;
    max-height:280px;
    object-fit:cover;
    margin-top:10px;
    border-radius:5px;
}
</style>
</head>
<body>

<!-- Navbar -->
<div class="navbar">
    <h2>Flipkart</h2>
    <input type="text" id="searchInput" placeholder="Search products...">
    <button onclick="searchProduct()">Search</button>
    <span id="user-info"></span>
    <a href="cart.html">Cart</a>
    <button id="logout-btn">Logout</button>
</div>

<!-- Banner -->
<div class="banner">
    <img src="https://rukminim2.flixkart.com/fk-p-flap/1688/280/image/29327f40e9c4d26b.jpg" alt="Banner">
</div>

<!-- Featured Products -->
<h2 style="text-align:center;margin:20px 0;">Featured Products</h2>
<div id="section-items-grid" class="products-grid"></div>

<script>
document.addEventListener("DOMContentLoaded", () => {
    let products = JSON.parse(localStorage.getItem("products")) || [];
    let cartData = JSON.parse(localStorage.getItem("cart")) || {};
    let currentUser = JSON.parse(localStorage.getItem("currentUser"));

    const userInfo = document.getElementById("user-info");
    const logoutBtn = document.getElementById("logout-btn");

    // Navbar user info
    if(userInfo){
        if(currentUser) userInfo.innerText = "Welcome, "+currentUser.username;
        else userInfo.innerHTML = `<a href="signin.html" style="color:white;">Sign In</a>`;
    }

    // Logout button
    if(logoutBtn){
        logoutBtn.onclick = ()=>{
            localStorage.removeItem("currentUser");
            location.reload(); // index.html par hi reload
        }
    }

    // Load featured products
    const section = document.getElementById("section-items-grid");
    section.innerHTML = "";
    products.slice(0,6).forEach(p => {
        const div = document.createElement("div");
        div.className = "item-card";
        div.innerHTML = `
            <img src="${p.image}" alt="${p.name}">
            <h4>${p.name}</h4>
            <p>â‚¹${p.price}</p>
            <button>Add to Cart</button>
        `;
        // Add to cart for current user
        div.querySelector("button").onclick = (e)=>{
            e.stopPropagation();
            if(!currentUser) return alert("Please login first!");
            let userCart = cartData[currentUser.username] || [];
            const found = userCart.find(x=>x.id===p.id);
            if(found) found.quantity +=1;
            else userCart.push({...p, quantity:1});
            cartData[currentUser.username] = userCart;
            localStorage.setItem("cart", JSON.stringify(cartData));
            alert("Added to cart ðŸ›’");
        };

        div.onclick = ()=> window.location.href = "product.html?id="+p.id;
        section.appendChild(div);
    });

    // Search function
    window.searchProduct = function(){
        const input = document.getElementById("searchInput");
        const keyword = input.value.trim().toLowerCase();
        if(!keyword) return alert("Enter product name");

        localStorage.setItem("lastSearch", keyword);
        const result = products.filter(p=> p.name.toLowerCase().includes(keyword));
        localStorage.setItem("searchResults", JSON.stringify(result));
        window.location.href = "search.html";
    }
});
</script>
</body>
</html>