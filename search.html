<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Search Results</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{font-family:Arial;margin:0;padding:0;background:#f1f3f6;}
.navbar{background:#2874f0;color:white;padding:10px 20px;display:flex;align-items:center;gap:10px;flex-wrap:wrap;}
.navbar input{flex:1;padding:8px;border-radius:4px;border:none;}
.navbar button{padding:8px 15px;background:#ff9f00;border:none;border-radius:4px;cursor:pointer;color:white;font-weight:bold;}
.navbar a{color:white;text-decoration:none;}
.products-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:15px;padding:15px;}
.item-card{background:white;padding:10px;border-radius:5px;cursor:pointer;transition:0.3s;}
.item-card:hover{transform:scale(1.05);}
.item-card img{width:100%;height:150px;object-fit:cover;border-radius:5px;}
</style>
</head>
<body>
<div class="navbar">
<h2>Flipkart</h2>
<input type="text" id="searchInput" placeholder="Search products...">
<button onclick="searchProduct()">Search</button>
<span id="user-info"></span>
<a href="cart.html">Cart</a>
<button id="logout-btn">Logout</button>
</div>

<h2 style="text-align:center;margin-top:20px;">Search Results</h2>
<div id="search-results" class="products-grid"></div>

<script>
let currentUser = JSON.parse(localStorage.getItem("currentUser"));
if(!currentUser){window.location.href="signup.html";}
document.getElementById("user-info").innerText = "Welcome, "+currentUser.username;
document.getElementById("logout-btn").onclick=()=>{localStorage.removeItem("currentUser");location.href="signup.html";};

let products = JSON.parse(localStorage.getItem("products")) || [];
let results = JSON.parse(localStorage.getItem("searchResults")) || [];

const section = document.getElementById("search-results");
const input = document.getElementById("searchInput");
input.value = localStorage.getItem("lastSearch") || "";

function renderResults(){
    section.innerHTML="";
    if(results.length===0){section.innerHTML="<p style='text-align:center;'>No products found!</p>"; return;}
    results.forEach(p=>{
        const div = document.createElement("div");
        div.className="item-card";
        div.innerHTML=`<img src="${p.image}"><h4>${p.name}</h4><p>â‚¹${p.price}</p><button>Add to Cart</button>`;
        div.querySelector("button").onclick=(e)=>{
            e.stopPropagation();
            let cart = JSON.parse(localStorage.getItem("cart_"+currentUser.username))||[];
            const found = cart.find(x=>x.id===p.id);
            if(found) found.qty+=1;
            else cart.push({...p, qty:1});
            localStorage.setItem("cart_"+currentUser.username,JSON.stringify(cart));
            alert("Added to cart ðŸ›’");
        }
        div.onclick=()=>window.location.href="product.html?id="+p.id;
        section.appendChild(div);
    });
}

renderResults();

window.searchProduct = function(){
    const keyword = input.value.trim().toLowerCase();
    if(!keyword) return alert("Enter product name");
    results = products.filter(p=>p.name.toLowerCase().includes(keyword));
    localStorage.setItem("searchResults",JSON.stringify(results));
    localStorage.setItem("lastSearch",keyword);
    renderResults();
}
</script>
</body>
</html>